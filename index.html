<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContractAI Analyst (Local)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9',
                            600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e',
                        }
                    }
                },
            },
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen overflow-hidden">
    <div id="root" class="h-full"></div>

    <script type="module">
        // Using explicit versions and dependencies to ensure Single React Instance
        import React, { useState, useEffect, useRef } from "https://esm.sh/react@18.2.0";
        import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";
        import ReactMarkdown from "https://esm.sh/react-markdown@9.0.1?deps=react@18.2.0,react-dom@18.2.0";

        // --- CONFIGURATION ---
        const apiKey = ""; // API Key set at top level for environment injection

        // --- ICONS (Inline SVGs) ---
        const IconBase = ({ children, className }) => React.createElement('svg', { 
            xmlns: "http://www.w3.org/2000/svg", 
            width: "24", height: "24", viewBox: "0 0 24 24", 
            fill: "none", stroke: "currentColor", strokeWidth: "2", 
            strokeLinecap: "round", strokeLinejoin: "round", 
            className 
        }, children);

        const Layout = (props) => React.createElement(IconBase, props, React.createElement("rect", { width: "18", height: "18", x: "3", y: "3", rx: "2", ry: "2" }), React.createElement("line", { x1: "3", x2: "21", y1: "9", y2: "9" }), React.createElement("line", { x1: "9", x2: "9", y1: "21", y2: "9" }));
        const FileText = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" }), React.createElement("polyline", { points: "14 2 14 8 20 8" }), React.createElement("line", { x1: "16", x2: "8", y1: "13", y2: "13" }), React.createElement("line", { x1: "16", x2: "8", y1: "17", y2: "17" }), React.createElement("line", { x1: "10", x2: "8", y1: "9", y2: "9" }));
        const Trash2 = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M3 6h18" }), React.createElement("path", { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" }), React.createElement("path", { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" }), React.createElement("line", { x1: "10", x2: "10", y1: "11", y2: "17" }), React.createElement("line", { x1: "14", x2: "14", y1: "11", y2: "17" }));
        const CheckCircle2 = (props) => React.createElement(IconBase, props, React.createElement("circle", { cx: "12", cy: "12", r: "10" }), React.createElement("path", { d: "m9 12 2 2 4-4" }));
        const RotateCw = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" }), React.createElement("path", { d: "M21 3v5h-5" }));
        const Database = (props) => React.createElement(IconBase, props, React.createElement("ellipse", { cx: "12", cy: "5", rx: "9", ry: "3" }), React.createElement("path", { d: "M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" }), React.createElement("path", { d: "M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" }));
        const UploadCloud = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" }), React.createElement("path", { d: "M12 12v9" }), React.createElement("path", { d: "m16 16-4-4-4 4" }));
        const Send = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "m22 2-7 20-4-9-9-4Z" }), React.createElement("path", { d: "M22 2 11 13" }));
        const Bot = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M12 8V4H8" }), React.createElement("rect", { width: "16", height: "12", x: "4", y: "8", rx: "2" }), React.createElement("path", { d: "M2 14h2" }), React.createElement("path", { d: "M20 14h2" }), React.createElement("path", { d: "M15 13v2" }), React.createElement("path", { d: "M9 13v2" }));
        const User = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" }), React.createElement("circle", { cx: "12", cy: "7", r: "4" }));
        const AlertTriangle = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" }), React.createElement("path", { d: "M12 9v4" }), React.createElement("path", { d: "M12 17h.01" }));
        const Loader2 = (props) => React.createElement(IconBase, props, React.createElement("path", { d: "M21 12a9 9 0 1 1-6.219-8.56" }));

        // --- SERVICES ---

        // 1. PDF Service
        const loadPdfJs = async () => {
            if (window.pdfjsLib) return;
            // Poll for library availability
            let attempts = 0;
            while (attempts < 20) {
                if (window.pdfjsLib) return;
                await new Promise(r => setTimeout(r, 200));
                attempts++;
            }
            throw new Error("PDF.js library failed to load");
        };

        const extractTextFromPDF = async (file, onProgress) => {
            await loadPdfJs();
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const typedarray = new Uint8Array(event.target?.result);
                        if (!window.pdfjsLib) throw new Error("PDF.js library not loaded");
                        
                        const pdf = await window.pdfjsLib.getDocument(typedarray).promise;
                        const maxPages = pdf.numPages;
                        let fullText = '';

                        for (let i = 1; i <= maxPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map((item) => item.str).join(' ');
                            fullText += `--- Page ${i} ---\n${pageText}\n\n`;
                            onProgress(i, maxPages);
                        }

                        resolve({ text: fullText, pageCount: maxPages });
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = (error) => reject(error);
                reader.readAsArrayBuffer(file);
            });
        };

        // 2. Storage Service (LOCAL STORAGE IMPLEMENTATION)
        const useStorage = () => {
            const [loading, setLoading] = useState(true);

            // Simulating a delay to mimic async behavior
            useEffect(() => {
                setTimeout(() => setLoading(false), 500);
            }, []);

            const getAllFiles = async () => {
                try {
                    const metadata = JSON.parse(localStorage.getItem('contractai_metadata') || '[]');
                    // Hydrate with content from separate keys
                    const files = metadata.map(file => {
                        const content = localStorage.getItem(`contractai_content_${file.id}`) || '';
                        return { ...file, content };
                    });
                    return files.sort((a, b) => (b.uploadedAt || 0) - (a.uploadedAt || 0));
                } catch (e) {
                    console.error("Local Storage Error", e);
                    return [];
                }
            };

            const saveFile = async (file) => {
                try {
                    const metadata = JSON.parse(localStorage.getItem('contractai_metadata') || '[]');
                    const newMetadata = [...metadata, {
                        id: file.id,
                        name: file.name,
                        size: file.size,
                        pageCount: file.pageCount,
                        status: file.status,
                        uploadedAt: file.uploadedAt
                    }];
                    
                    // Save content separately to avoid massive JSON parsing for list
                    try {
                        localStorage.setItem(`contractai_content_${file.id}`, file.content);
                        localStorage.setItem('contractai_metadata', JSON.stringify(newMetadata));
                    } catch (quotaError) {
                        alert("Storage Quota Exceeded! Your browser's Local Storage is full. Please delete some old contracts.");
                        console.error("Quota Exceeded", quotaError);
                    }
                } catch (e) {
                    console.error("Error saving file locally:", e);
                }
            };

            const deleteFile = async (id) => {
                try {
                    const metadata = JSON.parse(localStorage.getItem('contractai_metadata') || '[]');
                    const newMetadata = metadata.filter(f => f.id !== id);
                    localStorage.setItem('contractai_metadata', JSON.stringify(newMetadata));
                    localStorage.removeItem(`contractai_content_${id}`);
                } catch (e) {
                    console.error("Error deleting file:", e);
                }
            };

            const clearAllFiles = async (files) => {
                localStorage.removeItem('contractai_metadata');
                files.forEach(f => localStorage.removeItem(`contractai_content_${f.id}`));
            }

            return { saveFile, deleteFile, getAllFiles, clearAllFiles, loading, setLoading };
        };

        // 3. Gemini Service
        const sendMessageToGemini = async (history, currentContext, userMessage) => {
            // Offline check
            if (!navigator.onLine) {
                return "⚠️ **OFFLINE MODE DETECTED**\n\nI cannot analyze documents while offline because the AI model runs on Google's cloud servers. \n\nYou can still extract text from PDFs and view your saved documents, but you must connect to the internet to chat with the AI.";
            }

            // Robust Key Handling: Environment -> LocalStorage -> Prompt
            let currentKey = apiKey;
            if (!currentKey) {
                currentKey = localStorage.getItem("gemini_api_key") || "";
            }
            if (!currentKey) {
                const userKey = prompt("API Key not detected. Please enter your Gemini API Key (it will be saved locally):");
                if (userKey) {
                    localStorage.setItem("gemini_api_key", userKey);
                    currentKey = userKey;
                }
            }

            if (!currentKey) {
                console.error("API Key not found.");
                throw new Error("API Key missing");
            }

            const systemPrompt = `You are an expert Legal Contract Analyst AI. 
            Your goal is to assist users in understanding complex legal documents, finding specific clauses, and summarizing obligations.
            CONTEXT DOCUMENTS: ${currentContext}`;

            const contents = history.filter(m => m.role !== 'system').map(m => ({
                role: m.role === 'user' ? 'user' : 'model',
                parts: [{ text: m.content }]
            }));
            contents.push({ role: 'user', parts: [{ text: userMessage }] });

            // Use standard model name for better public key support
            const modelName = "gemini-1.5-flash"; 
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${currentKey}`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents, systemInstruction: { parts: [{ text: systemPrompt }] } })
                });

                if (!response.ok) {
                    let errMessage = `Gemini API Error: ${response.status} ${response.statusText}`;
                    try {
                        const errData = await response.json();
                        if (errData.error && errData.error.message) {
                            errMessage = `API Error: ${errData.error.message}`;
                        }
                    } catch (e) {}
                    console.error("Gemini API Error Detail:", errMessage);
                    throw new Error(errMessage);
                }
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't process that request.";
            } catch (error) {
                console.error("Gemini Request Failed:", error);
                throw error;
            }
        };

        // --- COMPONENTS ---

        const FileUpload = ({ onFileSelect, isProcessing }) => {
            const fileInputRef = useRef(null);
            const [isDragging, setIsDragging] = useState(false);

            const handleDragOver = (e) => { e.preventDefault(); setIsDragging(true); };
            const handleDragLeave = (e) => { e.preventDefault(); setIsDragging(false); };
            const handleDrop = (e) => {
                e.preventDefault(); setIsDragging(false);
                if (e.dataTransfer.files && e.dataTransfer.files.length > 0) onFileSelect(e.dataTransfer.files);
            };

            return React.createElement("div", {
                onClick: () => !isProcessing && fileInputRef.current?.click(),
                onDragOver: handleDragOver,
                onDragLeave: handleDragLeave,
                onDrop: handleDrop,
                className: `relative border-2 border-dashed rounded-xl p-6 text-center transition-all cursor-pointer 
                ${isDragging ? 'border-brand-500 bg-brand-50' : 'border-slate-300 hover:border-brand-400 hover:bg-slate-50'} 
                ${isProcessing ? 'opacity-50 cursor-not-allowed' : ''}`
            }, 
                React.createElement("input", { type: "file", ref: fileInputRef, onChange: (e) => e.target.files && onFileSelect(e.target.files), className: "hidden", accept: ".pdf", multiple: true, disabled: isProcessing }),
                React.createElement("div", { className: "flex flex-col items-center gap-3" },
                    React.createElement("div", { className: `p-3 rounded-full ${isDragging ? 'bg-brand-100 text-brand-600' : 'bg-slate-100 text-slate-500'}` }, React.createElement(UploadCloud, { className: "w-6 h-6" })),
                    React.createElement("div", null,
                        React.createElement("p", { className: "text-sm font-medium text-slate-700" }, isProcessing ? 'Processing...' : 'Click or Drag files'),
                        React.createElement("p", { className: "text-xs text-slate-400 mt-1" }, "PDF contracts only")
                    )
                )
            );
        };

        const ChatInterface = ({ messages, onSendMessage, isLoading, documentsLoaded }) => {
            const [input, setInput] = useState('');
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            useEffect(() => scrollToBottom(), [messages, isLoading]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!input.trim() || isLoading) return;
                onSendMessage(input);
                setInput('');
            };

            return React.createElement("div", { className: "flex flex-col h-full bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden" },
                React.createElement("div", { className: "flex-1 overflow-y-auto p-4 space-y-6 scrollbar-hide" },
                    messages.length === 0 && React.createElement("div", { className: "flex flex-col items-center justify-center h-full text-center text-slate-400 p-8" },
                        React.createElement(Bot, { className: "w-12 h-12 mb-4 text-slate-300" }),
                        React.createElement("p", { className: "text-lg font-medium text-slate-600" }, "Contract Analyst AI"),
                        React.createElement("p", { className: "text-sm max-w-md mt-2" }, !documentsLoaded ? "Upload contracts for analysis or ask general legal questions to get started." : "Ask me anything about the uploaded contracts.")
                    ),
                    messages.map((msg) => React.createElement("div", { key: msg.id, className: `flex gap-3 ${msg.role === 'user' ? 'justify-end' : 'justify-start'}` },
                        msg.role === 'model' && React.createElement("div", { className: "w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center flex-shrink-0 text-brand-600" }, React.createElement(Bot, { className: "w-5 h-5" })),
                        React.createElement("div", { className: `max-w-[85%] rounded-2xl px-4 py-3 text-sm leading-relaxed ${msg.role === 'user' ? 'bg-brand-600 text-white rounded-br-none' : 'bg-slate-50 text-slate-800 rounded-bl-none border border-slate-100'}` },
                            React.createElement(ReactMarkdown, { components: {
                                strong: ({node, ...props}) => React.createElement("span", { className: "font-bold text-brand-700 bg-brand-50/50 px-0.5 rounded", ...props }),
                                ul: ({node, ...props}) => React.createElement("ul", { className: "list-disc ml-4 my-2 space-y-1", ...props }),
                                ol: ({node, ...props}) => React.createElement("ol", { className: "list-decimal ml-4 my-2 space-y-1", ...props })
                            }}, msg.content)
                        ),
                        msg.role === 'user' && React.createElement("div", { className: "w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0 text-slate-500" }, React.createElement(User, { className: "w-5 h-5" }))
                    )),
                    isLoading && React.createElement("div", { className: "flex gap-3 justify-start" },
                        React.createElement("div", { className: "w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center flex-shrink-0 text-brand-600" }, React.createElement(Bot, { className: "w-5 h-5" })),
                        React.createElement("div", { className: "bg-slate-50 rounded-2xl rounded-bl-none px-4 py-3 border border-slate-100 flex items-center gap-2" },
                            React.createElement(Loader2, { className: "w-4 h-4 animate-spin text-brand-600" }),
                            React.createElement("span", { className: "text-xs text-slate-500 font-medium" }, "Analyzing contracts...")
                        )
                    ),
                    React.createElement("div", { ref: messagesEndRef })
                ),
                React.createElement("div", { className: "p-4 border-t border-slate-100 bg-slate-50" },
                    React.createElement("form", { onSubmit: handleSubmit, className: "flex gap-2" },
                        React.createElement("input", {
                            type: "text", value: input, onChange: (e) => setInput(e.target.value),
                            placeholder: documentsLoaded ? "Ask about liability, termination clauses, dates..." : "Type your question here...",
                            disabled: isLoading,
                            className: "flex-1 px-4 py-2.5 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 disabled:opacity-50 disabled:bg-slate-100 text-sm"
                        }),
                        React.createElement("button", { type: "submit", disabled: isLoading || !input.trim(), className: "px-4 py-2.5 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" }, React.createElement(Send, { className: "w-5 h-5" }))
                    )
                )
            );
        };

        const App = () => {
            const [files, setFiles] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);
            const [processingProgress, setProcessingProgress] = useState(null);
            const [messages, setMessages] = useState([]);
            const [isChatLoading, setIsChatLoading] = useState(false);
            const [documentsLoaded, setDocumentsLoaded] = useState(false);
            const [user, setUser] = useState({ uid: 'local-user' }); // Mock user for local storage
            
            // Switch to Local Storage Hook
            const { saveFile, deleteFile, getAllFiles, clearAllFiles, loading: isStorageLoading, setLoading: setStorageLoading } = useStorage();

            useEffect(() => {
                const loadFiles = async () => {
                    setStorageLoading(true);
                    const storedFiles = await getAllFiles();
                    if (storedFiles.length > 0) setFiles(storedFiles);
                    setStorageLoading(false);
                };
                loadFiles();
            }, []);

            const estimatedTokens = files.reduce((acc, file) => acc + (file.pageCount * 650), 0);
            const isOverContextLimit = estimatedTokens > 1000000;

            const handleFileSelect = async (fileList) => {
                setIsProcessing(true);
                setDocumentsLoaded(false);
                for (let i = 0; i < fileList.length; i++) {
                    const file = fileList[i];
                    const tempId = crypto.randomUUID();
                    try {
                        setProcessingProgress({ current: 0, total: 0 });
                        const result = await extractTextFromPDF(file, (loaded, total) => setProcessingProgress({ current: loaded, total }));
                        const newFile = {
                            id: tempId, name: file.name, size: file.size,
                            pageCount: result.pageCount, content: result.text,
                            status: 'ready', uploadedAt: Date.now()
                        };
                        setFiles(prev => [...prev, newFile]);
                        await saveFile(newFile);
                    } catch (error) {
                        console.error(`Error processing ${file.name}:`, error);
                        setFiles(prev => [...prev, { id: tempId, name: file.name, size: file.size, pageCount: 0, content: '', status: 'error', errorMessage: 'Failed to parse PDF', uploadedAt: Date.now() }]);
                    }
                }
                setIsProcessing(false);
                setProcessingProgress(null);
            };

            const removeFile = async (id) => {
                setFiles(prev => prev.filter(f => f.id !== id));
                setDocumentsLoaded(false);
                await deleteFile(id);
            };

            const handleClearAll = async () => {
                await clearAllFiles(files);
                setFiles([]);
                setDocumentsLoaded(false);
                setMessages([]);
            };

            const initializeAnalysis = async () => {
                if (files.length === 0) return;
                setIsChatLoading(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 800));
                    setDocumentsLoaded(true);
                    setMessages([{ id: 'system-1', role: 'model', content: `I have analyzed ${files.length} document(s) totaling approx. ${files.reduce((a,b) => a + (b.pageCount || 0), 0)} pages. I am ready to answer questions.`, timestamp: Date.now() }]);
                } finally { setIsChatLoading(false); }
            };

            const handleSendMessage = async (text) => {
                const newMessage = { id: Date.now().toString(), role: 'user', content: text, timestamp: Date.now() };
                const newHistory = [...messages, newMessage];
                setMessages(newHistory);
                setIsChatLoading(true);
                try {
                    const combinedContext = files.filter(f => f.status === 'ready').map(f => `--- DOCUMENT: ${f.name} ---\n${f.content}\n--- END DOCUMENT ---\n`).join('\n');
                    const responseText = await sendMessageToGemini(newHistory, combinedContext, text);
                    setMessages(prev => [...prev, { id: (Date.now() + 1).toString(), role: 'model', content: responseText, timestamp: Date.now() }]);
                } catch (error) {
                    console.error("Chat error:", error);
                    // Pass specific error to UI so user can see it
                    setMessages(prev => [...prev, { 
                        id: Date.now().toString(), 
                        role: 'model', 
                        content: `**Error:** ${error.message}. \n\nPlease check your API key and internet connection and try again.`, 
                        timestamp: Date.now() 
                    }]);
                } finally { setIsChatLoading(false); }
            };

            if (isStorageLoading) return React.createElement("div", { className: "h-screen w-screen flex flex-col items-center justify-center bg-slate-50 text-slate-400 gap-4" }, React.createElement("div", { className: "animate-spin rounded-full h-10 w-10 border-b-2 border-brand-600" }), React.createElement("p", { className: "text-sm font-medium animate-pulse" }, "Initializing Local Storage..."));

            return React.createElement("div", { className: "flex h-screen bg-slate-50 text-slate-900 font-sans" },
                React.createElement("div", { className: "w-80 bg-white border-r border-slate-200 flex flex-col hidden md:flex shrink-0" },
                    React.createElement("div", { className: "p-6 border-b border-slate-100" },
                        React.createElement("div", { className: "flex items-center gap-2 text-brand-700 mb-1" }, React.createElement(Layout, { className: "w-6 h-6" }), React.createElement("h1", { className: "font-bold text-xl tracking-tight" }, "ContractAI (Local)")),
                        React.createElement("p", { className: "text-xs text-slate-500 font-medium" }, "Legal Document Analyst")
                    ),
                    React.createElement("div", { className: "flex-1 overflow-y-auto p-4" },
                        React.createElement("div", { className: "mb-6" },
                            React.createElement(FileUpload, { onFileSelect: handleFileSelect, isProcessing }),
                            isProcessing && processingProgress && React.createElement("div", { className: "mt-4 bg-slate-50 rounded-lg p-3 border border-slate-200 shadow-sm" },
                                React.createElement("div", { className: "flex justify-between text-xs text-slate-600 mb-2 font-medium" },
                                    React.createElement("span", { className: "flex items-center gap-1" }, React.createElement(Loader2, { className: "w-3 h-3 animate-spin" }), " Extracting Text..."),
                                    React.createElement("span", null, `${processingProgress.current} / ${processingProgress.total}`)
                                ),
                                React.createElement("div", { className: "w-full bg-slate-200 rounded-full h-1.5 overflow-hidden" }, React.createElement("div", { className: "bg-brand-500 h-1.5 rounded-full transition-all duration-300", style: { width: `${(processingProgress.current / processingProgress.total) * 100}%` } }))
                            )
                        ),
                        React.createElement("div", { className: "space-y-3" },
                            React.createElement("div", { className: "flex items-center justify-between mb-2 px-1" },
                                React.createElement("h2", { className: "text-xs font-bold text-slate-400 uppercase tracking-wider" }, "Workspace"),
                                files.length > 0 && React.createElement("div", { className: "flex items-center gap-1 text-[10px] text-brand-600 bg-brand-50 px-2 py-0.5 rounded-full font-medium" }, React.createElement(Database, { className: "w-3 h-3" }), React.createElement("span", null, "Local Storage"))
                            ),
                            files.length === 0 && React.createElement("div", { className: "text-center py-8 border-2 border-dashed border-slate-100 rounded-xl" }, React.createElement("p", { className: "text-sm text-slate-400 italic" }, "No documents stored")),
                            files.map(file => React.createElement("div", { key: file.id, className: "group relative bg-white border border-slate-200 rounded-lg p-3 hover:shadow-md transition-all hover:border-brand-200" },
                                React.createElement("div", { className: "flex items-start gap-3" },
                                    React.createElement("div", { className: `mt-1 p-2 rounded-lg ${file.status === 'ready' ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}` }, React.createElement(FileText, { className: "w-4 h-4" })),
                                    React.createElement("div", { className: "flex-1 min-w-0" },
                                        React.createElement("h3", { className: "text-sm font-semibold text-slate-800 truncate", title: file.name }, file.name),
                                        React.createElement("div", { className: "flex items-center gap-2 mt-1" },
                                            React.createElement("span", { className: "text-[10px] font-medium text-slate-400 bg-slate-50 px-1.5 py-0.5 rounded" }, `${(file.size / 1024 / 1024).toFixed(2)} MB`),
                                            React.createElement("span", { className: "text-[10px] font-medium text-slate-500" }, `${file.pageCount} Pages`)
                                        )
                                    ),
                                    React.createElement("button", { onClick: () => removeFile(file.id), className: "opacity-0 group-hover:opacity-100 p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-all" }, React.createElement(Trash2, { className: "w-4 h-4" }))
                                )
                            ))
                        )
                    ),
                    React.createElement("div", { className: "p-4 border-t border-slate-200 bg-slate-50 space-y-3" },
                        files.length > 0 && !documentsLoaded && !isProcessing && React.createElement("button", { onClick: initializeAnalysis, className: "w-full flex items-center justify-center gap-2 bg-brand-600 text-white py-2.5 px-4 rounded-lg text-sm font-semibold hover:bg-brand-700 transition-colors shadow-sm active:transform active:scale-95" }, React.createElement(RotateCw, { className: "w-4 h-4" }), "Load Context to AI"),
                        documentsLoaded && React.createElement("div", { className: "w-full flex items-center justify-center gap-2 bg-emerald-100 text-emerald-800 py-2.5 px-4 rounded-lg text-sm font-medium border border-emerald-200 shadow-sm" }, React.createElement(CheckCircle2, { className: "w-4 h-4" }), "Context Active"),
                        isOverContextLimit && React.createElement("div", { className: "flex items-start gap-2 text-[10px] text-amber-700 leading-tight bg-amber-50 p-2 rounded border border-amber-200" }, React.createElement(AlertTriangle, { className: "w-3 h-3 mt-0.5 shrink-0" }), "Warning: Large context size."),
                        files.length > 0 && React.createElement("button", { onClick: handleClearAll, className: "w-full flex items-center justify-center gap-2 text-slate-400 hover:text-red-600 text-xs py-2 transition-colors font-medium" }, "Clear Workspace")
                    )
                ),
                React.createElement("div", { className: "flex-1 flex flex-col h-full relative bg-slate-100/50" },
                    React.createElement("div", { className: "md:hidden bg-white border-b border-slate-200 p-4 flex items-center justify-between shadow-sm" }, React.createElement("h1", { className: "font-bold text-slate-800 flex items-center gap-2" }, React.createElement(Layout, { className: "w-5 h-5 text-brand-600" }), "ContractAI")),
                    React.createElement("div", { className: "flex-1 p-2 md:p-6 overflow-hidden max-w-5xl mx-auto w-full" }, React.createElement(ChatInterface, { messages, onSendMessage: handleSendMessage, isLoading: isChatLoading, documentsLoaded }))
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
